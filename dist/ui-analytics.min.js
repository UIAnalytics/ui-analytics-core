var UIAnalytics=function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),e=function(t){return!!t&&"string"==typeof t},r=function(i){return!!i&&"object"===(void 0===i?"undefined":t(i))},a=function(t){return!!t&&"[object Function]"==={}.toString.call(t)},s={},o=function(t,i,n){i(n)},c=function(t){return{publish:function(i,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t){var e=s[t];Array.isArray(e)&&e.forEach(function(n){return o(t,n,i)}),n.invokeNewSubs&&(s[t]=e?s[t]:[],s[t].invokeImmediately=!0)}}(t+"-"+i,n,e)},subscribe:function(i,n){return function(t,i){var n=s[t];return n&&n.invokeImmediately?o(t,i):n?n.push(i):s[t]=[i],{_subscriptionCb:i}}(t+"-"+i,n)},unsubscribe:function(i,n){return function(t,i){if(t&&i&&i._subscriptionCb){var n=s[t];if(n){var e=void 0;s[t]=n.filter(function(t){return!(!e&&t===i._subscriptionCb&&(e=!0,1))})}}}(t+"-"+i,n)}}},u=function(){},f=console||{error:u,log:u,info:u},l=function(){f.error.apply(f,arguments)},g=function(){return JSON.parse(JSON.stringify({integrations:[],plugins:[],tracks:[],transforms:[],user:null}))},h=g();function d(t){h=Object.assign({},h,t)}function p(){return h}var y=Object.freeze({set:d,get:p,clear:function(){h=g()}}),m=function t(n,a,s,o){var c=this;i(this,t),this.type=n,this.name=a.trim(),this.properties=r(s)?JSON.parse(JSON.stringify(s)):{},this.trackOptions=r(o)?JSON.parse(JSON.stringify(o)):{};var u=this.trackOptions.integrationWhitelist;this.integrationWhitelist=Array.isArray(u)&&u.length>0?u:[];var f=this.trackOptions.integrationBlacklist;this.integrationBlacklist=Array.isArray(f)&&f.length>0?f:[];var g=this.trackOptions.groups;this.groups=Array.isArray(g)&&g.length>0?g:[],this.runTransform=function(t){var i=void 0;try{if(!(i=t(Object.assign({},c))))return void l('"'+trackInstance.name+'" was deleted by a transform. This is currently not allowed and we will ignore this transform. Update the \'integrationBlacklist\' array to "all" if you want it to fully block it.');e(i.name)&&i.name.trim()?c.name=i.name.trim():l('"'+c.name+"\" had it's string name removed by a transform. This is currently not allowed and we will ignore this name change and are reverting it."),c.properties=r(i.properties)?JSON.parse(JSON.stringify(i.properties)):{},c.trackOptions=r(i.trackOptions)?JSON.parse(JSON.stringify(i.trackOptions)):{},c.integrationWhitelist=Array.isArray(i.integrationWhitelist)?i.integrationWhitelist:[],c.integrationBlacklist=Array.isArray(i.integrationBlacklist)?i.integrationBlacklist:[],c.groups=Array.isArray(i.groups)?i.groups:[]}catch(t){l(t)}}},b=function(t){p().transforms.forEach(t.runTransform),d({tracks:p().tracks.concat([t])}),p().integrations.forEach(function(i){i.isReady()&&O(t,i)})},v=function(t,i,n){e(t)&&t.trim()?b(new m("event",t,i,n)):l("track was called without a string name as the first argument")},k=function(t,i,n){e(t)&&t.trim()?b(new m("page",t,i,n)):l("trackPage was called without a string name as the first argument")},O=function(t,i){if(t){var n=t.integrationWhitelist,e=t.integrationBlacklist;if((0===n.length||n.includes(i.name))&&(0===e.length||!e.includes(i.name)))if(i.track)try{var r=i.track(t);r&&r.catch&&r.catch(l)}catch(t){l(t)}else l('integration: "'+i.name+'" is initialized but does not have a track method')}},w=function(t,i){if(i.isReady()&&i.identifyUser)try{var n=i.identifyUser(t);n&&n.catch&&n.catch(l)}catch(t){l(t)}},S=function(){function t(n,e){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,t),this.pendingDefinition=a.pendingDefinition||!1,this.name=n,this.definition=e||{},this.initialize=this.definition.initialize,this.track=this.definition.track,this.identifyUser=this.definition.identifyUser,this.status="pending-definition",this.isReady=function(){return"ready"===r.status},this.options={},this.setOptions=function(t){r.options=Object.assign(r.options,t),r.definition.setOptions&&r.definition.setOptions(r.options)},this.getToolReference=function(){if(r.definition.getToolReference)return r.definition.getToolReference()},this.clearUserSession=function(){if(r.definition.clearUserSession)return r.definition.clearUserSession()},this.setGroup=function(t,i){r.definition.setGroup&&r.definition.setGroup(t,i)};var s=c("integration-"+this.name);this.subscribe=s.subscribe,this.unsubscribe=s.unsubscribe,this.publish=s.publish,e&&this.applyDefintion(e)}return n(t,[{key:"applyDefintion",value:function(t){var i=this;if(this.definition=t||{},this.initialize=t.initialize,this.track=t.track,this.identifyUser=t.identifyUser,this.initialize)try{this.status="initializing",this.publish("before-init");var n=this.initialize(t.initialOptions);(n&&n.then?n:Promise.resolve()).then(function(){i.status="ready",i.options&&t.setOptions&&t.setOptions(i.options),p().user&&w(p().user,i),p().tracks.forEach(function(t){O(t,i)}),i.publish("ready",null,{invokeNewSubs:!0})}).catch(function(t){i.fatalError(t)})}catch(t){this.fatalError(t)}}},{key:"fatalError",value:function(t){this.status="errored",this.publish("error",{error:t}),l("Fatal Error",t)}}]),t}(),A=function t(n){var e=this;i(this,t),this.name=n.name,this.on=n.subscribe,this.off=n.unsubscribe,this.options=n.setOptions,this.getToolReference=n.getToolReference,this.clearUserSession=n.clearUserSession,this.track=function(t,i,n){try{v(t,i,Object.assign({},n,{integrationWhitelist:[e.name]}))}catch(t){l(t)}},this.trackPage=function(t,i,n){try{k(t,i,Object.assign({},n,{integrationWhitelist:[e.name]}))}catch(t){l(t)}},this.group=function(t){return{options:function(i){try{n.setGroup(t,i)}catch(t){l(t)}},track:function(i,n,r){e.track(i,n,Object.assign({},r,{groups:[t]}))},trackPage:function(i,n,r){e.trackPage(i,n,Object.assign({},r,{groups:[t]}))}}},this.isReady=n.isReady,this.status=function(){return n.status}};var j=c("environment"),U=j.publish,E=window.addEventListener;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){U("page-dom-load")}):U("page-dom-load"),"interactive"===document.readyState?E("load",function(){U("page-load")}):"complete"===document.readyState&&U("page-load"),E("beforeunload",function(){U("page-before-unload")}),E("unload",function(){U("page-unload")});var D=j.subscribe,N=j.unsubscribe,T={"page-load":"page-load","page-dom-load":"page-dom-load","page-unload":"page-unload","page-before-unload":"page-before-unload"},R={name:"",triggers:["immediately","manual"],maxRuns:1,runCount:0},J=function t(n,e){var r=this;i(this,t);var s=function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];try{e.call.apply(e,[null,P].concat(i))}catch(t){l("Plugin errored while invoking its run function",t)}};this.name=n.name,this.triggers=Array.isArray(n.triggers)?n.triggers:[n.triggers],this.isDefined=a(e),this.run=function(){r.isDefined?r.triggers.includes("manual")?s.apply(void 0,arguments):l("Plugin was attempted to be run directly but it is not configured to be able to do so.\n          To call directly, a 'manual' entry needs to be in the plugin triggers field."):l("Plugin was attempted to be run but it has not been defined yet")},this.triggers.forEach(function(t){if(T[t])var i=D(t,function(){s(),N(i)})})},P={clearAllUserSessions:function(){d({user:null}),p().integrations.forEach(function(t){t.clearUserSession()})},identifyUser:function(t){r(t)?(d({user:t}),p().integrations.forEach(function(i){w(t,i)})):l("identifyUser was called with a non-object as the first argument:",t)},integration:function(t,i){if(e(t)){var n=p().integrations,a=n.filter(function(i){return i.name===t})[0],s=r(i);return a?s&&a.pendingDefinition?(a.pendingDefinition=!1,a.applyDefintion(i)):s&&l("integration "+t+" has already been defined and is attempting to be defined again"):(a=r(i)?new S(t,i):new S(t,{},{pendingDefinition:!0}),d({integrations:n.concat([a])})),new A(a)}l("integration requires a string name")},plugin:function(t,i){var n=e(t)&&!a(i)?t:null,s=void 0,o=void 0,c=void 0;if(n)(c=p().plugins.filter(function(t){return t.name===n})[0])||(c=new J(Object.assign({},R,{name:n})));else{if(a(t))o=t,s=Object.assign({},R);else{if(!a(i))return void l("a plugin was attempted to be created but it did not supply a plugin run function as a second argument to the .plugin() function");o=i,s=e(t)?Object.assign({},R,{name:t}):r(t)?Object.assign({},R,t):Object.assign({},R)}c=new J(s,o),d({plugins:p().plugins.concat([c])}),c.isDefined&&c.triggers.includes("immediately")&&c.run()}return c},track:v,trackPage:k,transformEvents:function(t){a(t)?(d({transforms:p().transforms.concat([t])}),p().tracks.forEach(function(i){i.runTransform(t)})):l("transform was called without a function as the first argument")},version:"0.0.1",_state:y};return P}();
