var UIAnalytics=function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),e=function(t){return!!t&&"string"==typeof t},r=function(i){return!!i&&"object"===(void 0===i?"undefined":t(i))},s=function(){},o=console||{error:s,log:s,info:s},a=function(){o.error.apply(o,arguments)},c=function(){return JSON.parse(JSON.stringify({integrations:[],tracks:[],transforms:[],user:null}))},f=c();function u(t){f=Object.assign({},f,t)}function l(){return f}var h=Object.freeze({set:u,get:l,clear:function(){f=c()}}),p=function t(n,s,o,c){var f=this;i(this,t),this.type=n,this.name=s.trim(),this.properties=r(o)?JSON.parse(JSON.stringify(o)):{},this.trackOptions=r(c)?JSON.parse(JSON.stringify(c)):{};var u=this.trackOptions.integrationWhitelist;this.integrationWhitelist=Array.isArray(u)&&u.length>0?u:["all"];var l=this.trackOptions.integrationBlacklist;this.integrationBlacklist=Array.isArray(l)&&l.length>0?l:[];var h=this.trackOptions.groups;this.groups=Array.isArray(h)&&h.length>0?h:[],this.runTransform=function(t){var i=void 0;try{if(!(i=t(Object.assign({},f))))return void a('"'+trackInstance.name+'" was deleted by a transform. This is currently not allowed and we will ignore this transform. Update the \'integrationBlacklist\' array to "all" if you want it to fully block it.');e(i.name)&&i.name.trim()?f.name=i.name.trim():a('"'+f.name+"\" had it's string name removed by a transform. This is currently not allowed and we will ignore this name change and are reverting it."),f.properties=r(i.properties)?JSON.parse(JSON.stringify(i.properties)):{},f.trackOptions=r(i.trackOptions)?JSON.parse(JSON.stringify(i.trackOptions)):{},f.integrationWhitelist=Array.isArray(i.integrationWhitelist)?i.integrationWhitelist:[],f.integrationBlacklist=Array.isArray(i.integrationBlacklist)?i.integrationBlacklist:[],f.groups=Array.isArray(i.groups)?i.groups:[],f.type=e(i.type)?i.type:f.type}catch(t){a(t)}}},y=function(t,i,n){if(e(t)&&t.trim()){var r=new p("track",t,i,n);l().transforms.forEach(r.runTransform),u({tracks:l().tracks.concat([r])}),l().integrations.forEach(function(t){t.isReady()&&g(r,t)})}else a("track was called without a string name as the first argument")},g=function(t,i){if(t){var n=t.integrationWhitelist,e=t.integrationBlacklist;if((n.includes("all")||n.includes(i.name))&&!e.includes("all")&&!e.includes(i.name))if(i.track)try{var r=i.track(t);r&&r.catch&&r.catch(a)}catch(t){a(t)}else a('integration: "'+i.name+'" is initialized but does not have a track method')}},d=function(t,i){if(i.isReady()&&i.identifyUser)try{var n=i.identifyUser(t);n&&n.catch&&n.catch(a)}catch(t){a(t)}},b=function(){function t(n,e){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,t),this.pendingDefinition=s.pendingDefinition||!1,this.name=n,this.definition=e||{},this.initialize=this.definition.initialize,this.track=this.definition.track,this.identifyUser=this.definition.identifyUser,this.status="pending-definition",this.isReady=function(){return"ready"===r.status},this.options={},this.setOptions=function(t){r.options=Object.assign(r.options,t),r.definition.setOptions&&r.definition.setOptions(r.options)},this.getToolReference=function(){if(r.definition.getToolReference)return r.definition.getToolReference()},this.subscriptions={},this.subscribe=function(t,i){var n=r.subscriptions[t];return n&&n.invokeImmediately?r.invokeTopicCb(t,i):n?n.push(i):r.subscriptions[t]=[i],{_subscriptionCb:i}},this.unsubscribe=function(t,i){if(t&&i&&i._subscriptionCb){var n=r.subscriptions[t];if(n){var e=void 0;r.subscriptions[t]=n.filter(function(t){return!(!e&&t===i._subscriptionCb)||(e=!0,!1)})}}},this.publish=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t){var e=r.subscriptions[t];Array.isArray(e)&&e.forEach(function(n){return r.invokeTopicCb(t,n,i)}),n.invokeNewSubs&&(r.subscriptions[t]=e?r.subscriptions[t]:[],r.subscriptions[t].invokeImmediately=!0)}},this.invokeTopicCb=function(t,i,n){i(n)},this.setGroup=function(t,i){r.definition.setGroup&&r.definition.setGroup(t,i)},e&&this.applyDefintion(e)}return n(t,[{key:"applyDefintion",value:function(t){var i=this;if(this.definition=t||{},this.initialize=t.initialize,this.track=t.track,this.identifyUser=this.definition.identifyUser,this.initialize)try{this.status="initializing",this.publish("before-init");var n=this.initialize(t.initialOptions);(n&&n.then?n:Promise.resolve()).then(function(){i.status="ready",i.options&&t.setOptions&&t.setOptions(i.options),l().user&&d(l().user,i),l().tracks.forEach(function(t){g(t,i)}),i.publish("ready",null,{invokeNewSubs:!0})}).catch(function(t){i.fatalError(t)})}catch(t){this.fatalError(t)}}},{key:"fatalError",value:function(t){this.status="errored",this.publish("error",{error:t}),a("Fatal Error",t)}}]),t}(),m=function t(n){var e=this;i(this,t),this.name=n.name,this.on=n.subscribe,this.off=n.unsubscribe,this.options=n.setOptions,this.getToolReference=n.getToolReference,this.track=function(t,i,n){try{y(t,i,Object.assign({},n,{integrationWhitelist:[e.name]}))}catch(t){a(t)}},this.group=function(t){return{options:function(i){try{n.setGroup(t,i)}catch(t){a(t)}},track:function(i,n,r){e.track(i,n,Object.assign({},r,{groups:[t]}))}}},this.isReady=n.isReady,this.status=function(){return n.status}};return{identifyUser:function(t){r(t)?(u({user:t}),l().integrations.forEach(function(i){d(t,i)})):a("identifyUser was called with a non-object as the first argument:",t)},integration:function(t,i){if(e(t)){var n=l().integrations,s=n.filter(function(i){return i.name===t})[0],o=r(i);return s?o&&s.pendingDefinition?(s.pendingDefinition=!1,s.applyDefintion(i)):o&&a("integration "+t+" has already been defined and is attempting to be defined again"):(s=r(i)?new b(t,i):new b(t,{},{pendingDefinition:!0}),u({integrations:n.concat([s])})),new m(s)}a("integration requires a string name")},track:y,transformEvents:function(t){var i;(i=t)&&"[object Function]"==={}.toString.call(i)?(u({transforms:l().transforms.concat([t])}),l().tracks.forEach(function(i){i.runTransform(t)})):a("transform was called without a function as the first argument")},version:"0.0.1",_state:h}}();
