var UIAnalytics=function(){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t=function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function i(i,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}(),e=function(i){return!!i&&"string"==typeof i},r=function(t){return!!t&&"object"===(void 0===t?"undefined":i(t))},s=function(){},o=console||{error:s,log:s,info:s},a=function(){o.error.apply(o,arguments)},c=function(){return JSON.parse(JSON.stringify({integrations:[],tracks:[],transforms:[],user:null}))},f=c();function u(i){f=Object.assign({},f,i)}function l(){return f}var h=Object.freeze({set:u,get:l,clear:function(){f=c()}}),p=function i(n,s,o,c){var f=this;t(this,i),this.type=n,this.name=s.trim(),this.properties=r(o)?JSON.parse(JSON.stringify(o)):{},this.trackOptions=r(c)?JSON.parse(JSON.stringify(c)):{};var u=this.trackOptions.integrationWhitelist;this.integrationWhitelist=Array.isArray(u)&&u.length>0?u:["all"];var l=this.trackOptions.integrationBlacklist;this.integrationBlacklist=Array.isArray(l)&&l.length>0?l:[];var h=this.trackOptions.groups;this.groups=Array.isArray(h)&&h.length>0?h:[],this.runTransform=function(i){var t=void 0;try{if(!(t=i(Object.assign({},f))))return void a('"'+trackInstance.name+'" was deleted by a transform. This is currently not allowed and we will ignore this transform. Update the \'integrationBlacklist\' array to "all" if you want it to fully block it.');e(t.name)&&t.name.trim()?f.name=t.name.trim():a('"'+f.name+"\" had it's string name removed by a transform. This is currently not allowed and we will ignore this name change and are reverting it."),f.properties=r(t.properties)?JSON.parse(JSON.stringify(t.properties)):{},f.trackOptions=r(t.trackOptions)?JSON.parse(JSON.stringify(t.trackOptions)):{},f.integrationWhitelist=Array.isArray(t.integrationWhitelist)?t.integrationWhitelist:[],f.integrationBlacklist=Array.isArray(t.integrationBlacklist)?t.integrationBlacklist:[],f.groups=Array.isArray(t.groups)?t.groups:[],f.type=e(t.type)?t.type:f.type}catch(i){a(i)}}},y=function(i,t,n){if(e(i)&&i.trim()){var r=new p("track",i,t,n);l().transforms.forEach(r.runTransform),u({tracks:l().tracks.concat([r])}),l().integrations.forEach(function(i){i.isReady()&&g(r,i)})}else a("track was called without a string name as the first argument")},g=function(i,t){if(i){var n=i.integrationWhitelist,e=i.integrationBlacklist;if((n.includes("all")||n.includes(t.name))&&!e.includes("all")&&!e.includes(t.name))if(t.track)try{var r=t.track(i);r&&r.catch&&r.catch(a)}catch(i){a(i)}else a('integration: "'+t.name+'" is initialized but does not have a track method')}},d=function(i,t){if(t.isReady()&&t.identifyUser)try{var n=t.identifyUser(i);n&&n.catch&&n.catch(a)}catch(i){a(i)}},b=function(){function i(n,e){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t(this,i),this.pendingDefinition=s.pendingDefinition||!1,this.name=n,this.definition=e||{},this.initialize=this.definition.initialize,this.track=this.definition.track,this.identifyUser=this.definition.identifyUser,this.status="pending-definition",this.isReady=function(){return"ready"===r.status},this.options={},this.setOptions=function(i){r.options=Object.assign(r.options,i),r.definition.setOptions&&r.definition.setOptions(r.options)},this.getToolReference=function(){if(r.definition.getToolReference)return r.definition.getToolReference()},this.clearUserSession=function(){if(r.definition.clearUserSession)return r.definition.clearUserSession()},this.subscriptions={},this.subscribe=function(i,t){var n=r.subscriptions[i];return n&&n.invokeImmediately?r.invokeTopicCb(i,t):n?n.push(t):r.subscriptions[i]=[t],{_subscriptionCb:t}},this.unsubscribe=function(i,t){if(i&&t&&t._subscriptionCb){var n=r.subscriptions[i];if(n){var e=void 0;r.subscriptions[i]=n.filter(function(i){return!(!e&&i===t._subscriptionCb)||(e=!0,!1)})}}},this.publish=function(i,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i){var e=r.subscriptions[i];Array.isArray(e)&&e.forEach(function(n){return r.invokeTopicCb(i,n,t)}),n.invokeNewSubs&&(r.subscriptions[i]=e?r.subscriptions[i]:[],r.subscriptions[i].invokeImmediately=!0)}},this.invokeTopicCb=function(i,t,n){t(n)},this.setGroup=function(i,t){r.definition.setGroup&&r.definition.setGroup(i,t)},e&&this.applyDefintion(e)}return n(i,[{key:"applyDefintion",value:function(i){var t=this;if(this.definition=i||{},this.initialize=i.initialize,this.track=i.track,this.identifyUser=i.identifyUser,this.initialize)try{this.status="initializing",this.publish("before-init");var n=this.initialize(i.initialOptions);(n&&n.then?n:Promise.resolve()).then(function(){t.status="ready",t.options&&i.setOptions&&i.setOptions(t.options),l().user&&d(l().user,t),l().tracks.forEach(function(i){g(i,t)}),t.publish("ready",null,{invokeNewSubs:!0})}).catch(function(i){t.fatalError(i)})}catch(i){this.fatalError(i)}}},{key:"fatalError",value:function(i){this.status="errored",this.publish("error",{error:i}),a("Fatal Error",i)}}]),i}(),m=function i(n){var e=this;t(this,i),this.name=n.name,this.on=n.subscribe,this.off=n.unsubscribe,this.options=n.setOptions,this.getToolReference=n.getToolReference,this.clearUserSession=n.clearUserSession,this.track=function(i,t,n){try{y(i,t,Object.assign({},n,{integrationWhitelist:[e.name]}))}catch(i){a(i)}},this.group=function(i){return{options:function(t){try{n.setGroup(i,t)}catch(i){a(i)}},track:function(t,n,r){e.track(t,n,Object.assign({},r,{groups:[i]}))}}},this.isReady=n.isReady,this.status=function(){return n.status}};return{clearAllUserSessions:function(){u({user:null}),l().integrations.forEach(function(i){i.clearUserSession()})},identifyUser:function(i){r(i)?(u({user:i}),l().integrations.forEach(function(t){d(i,t)})):a("identifyUser was called with a non-object as the first argument:",i)},integration:function(i,t){if(e(i)){var n=l().integrations,s=n.filter(function(t){return t.name===i})[0],o=r(t);return s?o&&s.pendingDefinition?(s.pendingDefinition=!1,s.applyDefintion(t)):o&&a("integration "+i+" has already been defined and is attempting to be defined again"):(s=r(t)?new b(i,t):new b(i,{},{pendingDefinition:!0}),u({integrations:n.concat([s])})),new m(s)}a("integration requires a string name")},track:y,transformEvents:function(i){var t;(t=i)&&"[object Function]"==={}.toString.call(t)?(u({transforms:l().transforms.concat([i])}),l().tracks.forEach(function(t){t.runTransform(i)})):a("transform was called without a function as the first argument")},version:"0.0.1",_state:h}}();
