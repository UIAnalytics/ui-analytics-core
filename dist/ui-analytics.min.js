!function(){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t=function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function i(i,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}return function(t,n,r){return n&&i(t.prototype,n),r&&i(t,r),t}}(),r=function(i){return!!i&&"string"==typeof i},e=function(t){return!!t&&"object"===(void 0===t?"undefined":i(t))},s=function(){},a=window.console||{error:s,log:s,info:s},o=function(){a.error.apply(a,arguments)},c=function(){return JSON.parse(JSON.stringify({integrations:[],tracks:[],transforms:[]}))},u=c();function f(i){u=Object.assign({},u,i)}function l(){return u}var h=Object.freeze({set:f,get:l,clear:function(){u=c()}}),p=function i(n,s,a,c){var u=this;t(this,i),this.type=n,this.name=s.trim(),this.properties=e(a)?JSON.parse(JSON.stringify(a)):{},this.trackOptions=e(c)?JSON.parse(JSON.stringify(c)):{};var f=this.trackOptions.integrationWhitelist;this.integrationWhitelist=Array.isArray(f)&&f.length>0?f:["all"];var l=this.trackOptions.integrationBlacklist;this.integrationBlacklist=Array.isArray(l)&&l.length>0?l:[],this.runTransform=function(i){var t=void 0;try{if(!(t=i(Object.assign({},u))))return void o('"'+trackInstance.name+'" was deleted by a transform. This is currently not allowed and we will ignore this transform. Update the \'integrationBlacklist\' array to "all" if you want it to fully block it.');r(t.name)&&t.name.trim()?u.name=t.name.trim():o('"'+u.name+"\" had it's string name removed by a transform. This is currently not allowed and we will ignore this name change and are reverting it."),u.properties=e(t.properties)?JSON.parse(JSON.stringify(t.properties)):{},u.trackOptions=e(t.trackOptions)?JSON.parse(JSON.stringify(t.trackOptions)):{},u.integrationWhitelist=Array.isArray(t.integrationWhitelist)?t.integrationWhitelist:[],u.integrationBlacklist=Array.isArray(t.integrationBlacklist)?t.integrationBlacklist:[],u.type=r(t.type)?t.type:u.type}catch(i){o(i)}}},y=function(i,t,n){if(r(i)&&i.trim()){var e=new p("track",i,t,n);l().transforms.forEach(e.runTransform),f({tracks:l().tracks.concat([e])}),l().integrations.forEach(function(i){i.isReady()&&g(e,i)})}else o("track was called without a string name as the first argument")},g=function(i,t){if(i&&(i.integrationWhitelist.includes("all")||i.integrationWhitelist.includes(t.name))&&!i.integrationBlacklist.includes("all")&&!i.integrationBlacklist.includes(t.name))if(t.track)try{var n=t.track(i);n&&n.catch&&n.catch(o)}catch(i){o(i)}else o('integration: "'+t.name+'" is initialized but does not have a track method')},d=function(){function i(n,r){var e=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t(this,i),this.pendingDefinition=s.pendingDefinition||!1,this.name=n,this.definition=r||{},this.initialize=this.definition.initialize,this.track=this.definition.track,this.status="pending-definition",this.isReady=function(){return"ready"===e.status},this.subscriptions={},this.subscribe=function(i,t){var n=e.subscriptions[i];return n&&n.invokeImmediately?e.invokeTopicCb(i,t):n?n.push(t):e.subscriptions[i]=[t],{_subscriptionCb:t}},this.unsubscribe=function(i,t){if(i&&t&&t._subscriptionCb){var n=e.subscriptions[i];if(n){var r=void 0;e.subscriptions[i]=n.filter(function(i){return!(!r&&i===t._subscriptionCb)||(r=!0,!1)})}}},this.publish=function(i,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i){var r=e.subscriptions[i];Array.isArray(r)&&r.forEach(function(n){return e.invokeTopicCb(i,n,t)}),n.invokeNewSubs&&(e.subscriptions[i]=r?e.subscriptions[i]:[],e.subscriptions[i].invokeImmediately=!0)}},this.invokeTopicCb=function(i,t,n){t(n)},r&&this.applyDefintion(r)}return n(i,[{key:"applyDefintion",value:function(i){var t=this;if(this.definition=i||{},this.initialize=this.definition.initialize,this.track=this.definition.track,this.initialize)try{this.status="initializing",this.publish("before-init");var n=this.initialize();(n&&n.then?n:Promise.resolve()).then(function(){t.status="ready",l().tracks.forEach(function(i){g(i,t)}),t.publish("ready",null,{invokeNewSubs:!0})}).catch(function(i){t.fatalError(i)})}catch(i){this.fatalError(i)}}},{key:"fatalError",value:function(i){this.status="errored",this.publish("error",{error:i}),o("Fatal Error",i)}}]),i}(),b=function i(n){var r=this;t(this,i),this.name=n.name,this.on=n.subscribe,this.off=n.unsubscribe,this.options=n.setOptions,this.getIdentifiers=n.getIdentifiers,this.setGroup=n.setGroup,this.track=function(i,t,n){try{y(i,t,Object.assign({},n,{integrationWhitelist:[r.name]}))}catch(i){o(i)}},this.isReady=n.isReady,this.status=function(){return n.status}};function m(i,t){if(r(i)){var n=l().integrations,s=n.filter(function(t){return t.name===i})[0],a=e(t);return s?a&&s.pendingDefinition?(s.pendingDefinition=!1,s.applyDefintion(t)):a&&o("integration "+i+" has already been defined and is attempting to be defined again"):(s=e(t)?new d(i,t):new d(i,{},{pendingDefinition:!0}),f({integrations:n.concat([s])})),new b(s)}o("integration requires a string name")}window.UIAnalytics={version:"0.0.1",track:y,integration:m,integrations:function(i){if(Array.isArray(i))return i.map(function(i){return m(i)});o("integrations requires an arrat of string names")},transformEvents:function(i){var t;(t=i)&&"[object Function]"==={}.toString.call(t)?(f({transforms:l().transforms.concat([i])}),l().tracks.forEach(function(t){t.runTransform(i)})):o("transform was called without a function as the first argument")},_state:h}}();
